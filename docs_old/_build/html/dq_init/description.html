<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Description &#8212; Liger IRIS DRS vunknown</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Step Arguments" href="arguments.html" />
    <link rel="prev" title="Data Quality (DQ) Initialization" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            


  <section id="description">
<h1>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h1>
<p>The Data Quality (DQ) initialization step in the calibration pipeline
populates the DQ mask for the input dataset. Flags from the
appropriate static mask reference file in CRDS are copied into the
<code class="docutils literal notranslate"><span class="pre">PIXELDQ</span></code> array of the input dataset, because it is assumed that flags in the
mask reference file pertain to problem conditions that are group- and
integration-independent.</p>
<p>We use the same flagging convention used for JWST, see
<a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/references_general/references_general.html#data-quality-flags">their documentation</a>.</p>
<p>A bad pixel mask is a <cite>datamodels.TMTMaskModel</cite> object with a <cite>dq</cite> extension
with size <cite>(4096x4096)</cite> of time <cite>uint32</cite>.</p>
<p>It can be created with:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jwst.datamodels</span> <span class="kn">import</span> <span class="n">TMTMaskModel</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">TMTMaskModel</span><span class="p">()</span>
</pre></div>
</div>
<p>First we need to setup metadata:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;IRIS&quot;</span>
<span class="n">f</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="s2">&quot;IRIS1&quot;</span>
</pre></div>
</div>
<p>Then we can create the 2D array and set some flag value:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">dq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4096</span><span class="p">,</span><span class="mi">4096</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">dq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4096</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">1024</span> <span class="c1"># dead pixel</span>
<span class="n">f</span><span class="o">.</span><span class="n">dq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4096</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">2048</span> <span class="c1"># hot pixel</span>
</pre></div>
</div>
<p>check the content of the flag:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dq</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">16777196</span><span class="p">,</span>       <span class="mi">10</span><span class="p">,</span>       <span class="mi">10</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span>   <span class="mf">0.</span>        <span class="p">,</span>  <span class="mf">682.66666667</span><span class="p">,</span> <span class="mf">1365.33333333</span><span class="p">,</span> <span class="mf">2048.</span>        <span class="p">]))</span>
</pre></div>
</div>
<p>And finally write to the <cite>CRDS</cite> cache:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;crds_cache/references/tmt/iris/tmt_iris_mask_0001.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Which flag is picked up by the pipeline is determined by the <cite>tmt_iris_mask_0001.rmap</cite> file,
see <a class="reference external" href="https://github.com/oirlab/tmt-crds-cache/blob/master/mappings/tmt/tmt_iris_mask_0001.rmap">the current file content on Github</a>.</p>
<p>The actual process consists of the following steps:</p>
<blockquote>
<div><ul class="simple">
<li><p>Determine what MASK reference file to use via the interface to the bestref
utility in CRDS.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">PIXELDQ</span></code> or <code class="docutils literal notranslate"><span class="pre">GROUPDQ</span></code> arrays of the input dataset do not already exist,
which is sometimes the case for raw input products, create these arrays in
the input data model and initialize them to zero. The <code class="docutils literal notranslate"><span class="pre">PIXELDQ</span></code> array will be
2D, with the same number of rows and columns as the input science data.
The <code class="docutils literal notranslate"><span class="pre">GROUPDQ</span></code> array will be 4D with the same dimensions (nints, ngroups,
nrows, ncols) as the input science data array.</p></li>
<li><p>Check to see if the input science data is in subarray mode. If so, extract a
matching subarray from the full-frame MASK reference file.</p></li>
<li><p>Copy the DQ flags from the reference file mask to the science data <code class="docutils literal notranslate"><span class="pre">PIXELDQ</span></code>
array using numpy’s <code class="docutils literal notranslate"><span class="pre">bitwise_or</span></code> function.</p></li>
</ul>
</div></blockquote>
<p>See an <a class="reference external" href="https://gist.github.com/zonca/e15620ff5d26652bc201b180ec00cdce">example notebook on how to inizialize the bad pixel mask</a>.</p>
</section>



          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Liger IRIS DRS</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../example-run.html">Example pipeline execution</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design.html">IRIS Data Reduction System design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html#purpose">Purpose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html#software-infrastructure">Software infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html#processing-levels-and-data-product-stages">Processing levels and data product stages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html#file-format">File format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html#example-run">Example run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html#access-calibration-files-via-the-calibration-reference-data-system-crds">Access calibration files via the Calibration Reference Data System (CRDS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html#metadata">Metadata</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../calibration-database.html">Calibration</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../available-steps.html">Available algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html#imager-algorithms">Imager Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html#ifs-algorithms">IFS Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html#advanced-algorithms">Advanced Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html#calibration-algorithms">Calibration algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../subarrays.html">Support for Subarrays</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.open.html">open</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.AssignWCSStep.html">AssignWCSStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.CreateFlatfield.html">CreateFlatfield</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.DQInitStep.html">DQInitStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.DQModel.html">DQModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.DarkModel.html">DarkModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.DarkSubtractionStep.html">DarkSubtractionStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.FitRampStep.html">FitRampStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.FlatFieldStep.html">FlatFieldStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.FlatModel.html">FlatModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.IFUCubeModel.html">IFUCubeModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.IFUImageModel.html">IFUImageModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.ImagerModel.html">ImagerModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.ImagerStage2Pipeline.html">ImagerStage2Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.LigerIRISDataModel.html">LigerIRISDataModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.MergeSubarraysStep.html">MergeSubarraysStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.NonlinCorrectionStep.html">NonlinCorrectionStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.NonlinearReadoutParametersModel.html">NonlinearReadoutParametersModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.NormalizeStep.html">NormalizeStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.ParseSubarrayMapStep.html">ParseSubarrayMapStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.RampModel.html">RampModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.ReferenceFileModel.html">ReferenceFileModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.SkySubtractionImagerStep.html">SkySubtractionImagerStep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.Stage1Pipeline.html">Stage1Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/liger_iris_pipeline.UnsupportedPythonError.html">UnsupportedPythonError</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../available-steps.html">Available algorithms</a><ul>
  <li><a href="index.html">Data Quality (DQ) Initialization</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Data Quality (DQ) Initialization</a></li>
      <li>Next: <a href="arguments.html" title="next chapter">Step Arguments</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Bryson Cale, Andrea Zonca, Shelley Wright.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/dq_init/description.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>